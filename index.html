<!DOCTYPE html>
<head><meta charset="utf-8"></head>
<style>
* {-webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box; }
.person {
  margin: 15px 0;
  padding: 15px;
  background: #f2f2f2;
  border-radius: 8px;
  min-height: 170px;
}

.person:after {
  clear: both;
  display: table;
  content: "";
}

.person h3 {
  margin: 0;
}

.personContent {
  display: inline-block;
  float: left;
}
@media (min-width: 1025px) {
  .personContent {
    width: 65%;
  }
}
@media (min-width: 731px) and (max-width: 1024px) {
  .personContent {
    width: 65%;
  }
}
@media (min-width: 320px) and (max-width: 730px) {
  .personContent {
    width: 100%;
  }
}

.photoHolder {
  text-align: center;
  display: inline-block;
  float: right;
}
@media (min-width: 1025px) {
  .photoHolder {
    width: 35%;
    padding: 0 10px 10px 10px;
  }
}
@media (min-width: 731px) and (max-width: 1024px) {
  .photoHolder {
    width: 35%;
  }
}
@media (min-width: 320px) and (max-width: 730px) {
  .photoHolder {
    width: 100%;
  }
}

.directoryPhoto {
  width: 100%;
  height: auto;
  max-width: 200px;
  box-shadow: none !important;
}

.badge {
  width: 45px;
  display: inline-block;
  margin: 2px 5px;
  border-radius: 0 !important;
  box-shadow: none !important;
}

.social{

}

.social a{
	color: #000;
	font-size: 35px;
	margin: 5px 10px;
}

.social a:visited{
	color: #000;
}

.social a:hover{
	color: #ffce38;
}

.studios{
	text-align: center;
}

.studios:after{
    clear: both;
    display: table;
    content:"";
    }
	
.studio img{
	width: 100%;
	mheight: 100%;
	border-radius: 0 !important;
  	box-shadow: none !important;
}

.studio{
	vertical-align: top;
	text-align: center;
	width: 109px;
	height: 109px;
	background: #f2f2f2;
    border-radius: 20px;
    display: inline-block;
	margin: 17px;
	/*cursor: pointer;*/
	overflow: hidden;
	box-shadow: 0 3px 4px 2px rgba(0,0,0,.2);
}

.studio:hover{
	/*background: #ffce38;*/
}
</style>

<h3> <span class="devCount"></span> Independant Game Developers!</h3>
<h1>New, or have questions?</h1>
<p>Contact <a href="mailto:mjrevel@gmail.com ">Mike</a>, <a href="mailto:barryrowe@gmail.com">Barry</a>, <a href="mailto:mattiegrichards@gmail.com ">Mattie</a>, <a href="mailto:eric@twoscoopgames.com">Eric</a>, or <a href="mailto:alex@twoscoopgames.com">Alex</a>, and we can help you out!</p>
<div class="loading">loading...</div>
<div class="studiosContainer"><h3>Studios:</h3></div>
	<div class="directoryPage"><h3>Members:</h3></div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<script>
var studioData = {
	"ggj14": {
		"link": "ggj14link",
		"description": " - Global Game Jam - 2014 - We dont see things as they are, we see them as we are.",
		"image": "http://gamedevlou.org/wp-content/uploads/2015/02/badge-ggj14.png"
	},
	"ld29": {
		"link": "ld29link",
		"description": " - Ludum Dare 29 - April 2014	- Beneath the surface",
		"image": "http://gamedevlou.org/wp-content/uploads/2015/02/badge-ld29.png"
	},
	"ld30": {
		"link": "ld30link",
		"description": " - Ludum Dare 30 - August 2014 - Connected Worlds",
		"image": "http://gamedevlou.org/wp-content/uploads/2015/02/badge-ld30.png"
	},
	"ld31": {
		"link": "ld31link",
		"description": " - Ludum Dare 31 - December 2014 - Entire Game on One Screen!",
		"image": "http://gamedevlou.org/wp-content/uploads/2015/02/badge-ld31.png"
	},
	"ggj15": {
		"link": "ggj15link",
		"description": " - Global Game Jam - 2015 - What do we do now?",
		"image": "http://gamedevlou.org/wp-content/uploads/2015/02/badge-ggj15.png"
	}
};

var docId = "1W3S_j9vi58Y5BMTPLdWptTQwScMWv5KrkU-r9R2_dvU";
var url = "https://spreadsheets.google.com/feeds/list/" + docId + "/od6/public/values?alt=json-in-script&callback=?";
var people;

jQuery.getJSON(url).success(function(data) {
	people = data.feed.entry;

	$(".directoryPage").append(displayPeople(people));

	$(".devCount").text(countPeople(people));

	$(".studiosContainer").append(diaplayStudios(getStudioData(people)));

	$(".loading").hide();

}).error(function(message) {
	console.error("error" + message); 
	$(".directoryPage").append("There was an error loading the directory");
});

function createDirectory(people, div){
	for (var i =0; i < people.length; i++){
		var person = people[i];
		cleanGoogleDocsData(person);
	
	}
}


function getStudioData(people){
	var studios = {};
	for (var i =0; i < people.length; i++){
		if(hasContent(people[i].studio.$t) && people[i].showonsite.$t === "TRUE"){
			studios['"'+ people[i].studio.$t +'"'] = {
				"logo": people[i].studiologo.$t,
				"link": people[i].studiolink.$t
			};
		}
	}
	return studios;
}

function diaplayStudios(studios){
	console.log("studios", studios);
	var studioHTML = "<div class='studios'>";

	Object.keys(studios).forEach(function(studio) {
		if(hasContent(studios[studio].logo)){
			studioHTML += "<div class='studio' data-link='" + studios[studio].link + "'>";
			studioHTML += "<img src='" + studios[studio].logo + "'/ alt='" + studio + "'>";
			studioHTML += "</div>";
		}
	});
	return studioHTML + "</div>";
}

function countPeople(people){
	var count = 0;
	for (var i =0; i < people.length; i++){
		if(people[i].showonsite.$t === "TRUE"){
			count++;
		}
	}
	return count;
}

function displayPeople(people){
	var peopleHTML = ""
	for (var i =0; i < people.length; i++){
		var person = people[i];
		
		cleanGoogleDocsData(person);

		if(person.showonsite.$t === "TRUE"){
			peopleHTML += "<div class='person'>"; 
			peopleHTML += "<div class='photoHolder'>";
			peopleHTML += addPhoto(person);
			peopleHTML += addBadges(person, badgeData);
			peopleHTML += "</div>";
			peopleHTML += "<div class='personContent'>";
			peopleHTML += addName(person);
			peopleHTML += addField(person, "Studio", "studio");
			peopleHTML += addField(person, "Bio", "bio");
			peopleHTML += addField(person, "Projects", "projects");
			peopleHTML += addField(person, "Skills", "skills");
			peopleHTML += addField(person, "Seeking", "seeking");
			peopleHTML += addWebsite(person);
			peopleHTML += "<div class='social'>";
			peopleHTML += addEmail(person);
			peopleHTML += addTwitter(person);
			peopleHTML += addGithub(person);
			peopleHTML += addTumblr(person);
			peopleHTML += addGooglePlus(person);
			peopleHTML += addSteam(person);
			peopleHTML += "</div>";
			peopleHTML += "</div>";
			peopleHTML += "</div>";
		}
	}

	return peopleHTML;
}

function addName(person){
	var name = "<h3>";
	var firstname = person.firstname.$t;
	var lastname = person.lastname.$t;
	var nicknames = person.nicknames.$t;
	if(hasContent(firstname)) {
		name += firstname + " ";
	}
	if(hasContent(nicknames)) {
		name += "'"+nicknames+"' ";
	}
	if(hasContent(lastname)) {
		name += lastname;
	}
	return name + "</h3>";
}
function addPhoto(person) {
	var photoURL = person.photourl.$t;
	if(!hasContent(photoURL)){
		return "<img class='directoryPhoto' src='http://gamedevlou.org/wp-content/uploads/2015/02/nophoto.png'></img>";
	}
	return "<img class='directoryPhoto' src='" + photoURL + "'></img>";
}

function addEmail(person) {
	var email = person.email.$t;
	if(!hasContent(email)){
		return "";
	}
	return "<a href='mailto:"+email+"'><i class='fa fa-envelope'></i></a>";
}

function addField(person, name, field) {
	var field = person[field].$t;
	if(!hasContent(field)){
		return "";
	}
	return "<p><strong>"+name+": </strong>" + field + "</a></p>";
}

function addWebsite(person) {
	var website = person["website"].$t;
	if(!hasContent(website)){
		return "";
	}
	return "<p><strong>Website: </strong><a href='" + website + "'>"+website+"</a></p>";
}

function addTwitter(person) {
	var twitterId = person["twitter"].$t;
	if(!hasContent(twitterId)){
		return "";
	}
	return "<a href='https://twitter.com/"+twitterId+"'><i class='fa fa-twitter'></i></a>";
}
function addTumblr(person) {
	var tumblrId = person["tumblr"].$t;
	if(!hasContent(tumblrId)){
		return "";
	}
	return "<a href='http://"+tumblrId+".tumblr.com/'><i class='fa fa-tumblr'></i></a>";
}

function addGithub(person) {
	var githubId = person["github"].$t;
	if(!hasContent(githubId)){
		return "";
	}
	return "<a href='http://github.com/"+githubId+"'><i class='fa fa-github'></i></a>";
}

function addGooglePlus(person) {
	var googleplusId = person["googleplus"].$t;
	if(!hasContent(googleplusId)){
		return "";
	}
	return "<a href='http://googleplus.com/"+googleplusId+"'><i class='fa fa-googleplus'></i></a>";
}

function addSteam(person) {
	var steamId = person["steam"].$t;
	if(!hasContent(steamId)){
		return "";
	}
	return "<a href='http://steamcommunity.com/id/"+steamId+"'><i class='fa fa-steam'></i></a>";
}

var badgeData = {
	"ggj14": {
		"link": "ggj14link",
		"description": " - Global Game Jam - 2014 - We dont see things as they are, we see them as we are.",
		"image": "http://gamedevlou.org/wp-content/uploads/2015/02/badge-ggj14.png"
	},
	"ld29": {
		"link": "ld29link",
		"description": " - Ludum Dare 29 - April 2014	- Beneath the surface",
		"image": "http://gamedevlou.org/wp-content/uploads/2015/02/badge-ld29.png"
	},
	"ld30": {
		"link": "ld30link",
		"description": " - Ludum Dare 30 - August 2014 - Connected Worlds",
		"image": "http://gamedevlou.org/wp-content/uploads/2015/02/badge-ld30.png"
	},
	"ld31": {
		"link": "ld31link",
		"description": " - Ludum Dare 31 - December 2014 - Entire Game on One Screen!",
		"image": "http://gamedevlou.org/wp-content/uploads/2015/02/badge-ld31.png"
	},
	"ggj15": {
		"link": "ggj15link",
		"description": " - Global Game Jam - 2015 - What do we do now?",
		"image": "http://gamedevlou.org/wp-content/uploads/2015/02/badge-ggj15.png"
	}
};

function addBadges(person, data){
	var badges = "<div class='badges'>";

	Object.keys(data).forEach(function(badge) {
		var thisBadge = data[badge];
		var gameName = person[badge].$t;
		var gameLink = person[thisBadge.link].$t
		if(hasContent(person[badge].$t)){
			var badge = "<img class='badge' src='" + thisBadge.image + "' alt='" + gameName + thisBadge.description + "' title='" + gameName + thisBadge.description + "'/>";
			if(hasContent(gameLink)){
				badges += "<a href='"+gameLink+"' target='_blank'>";
				badges += badge;
				badges += "</a>";
			}else{
				badges += badge;
			}
		}
	});

	return badges += "</div>";
}

function cleanGoogleDocsData(person){
	Object.keys(person).forEach(function(prop) {
		if (prop.indexOf("gsx$") === 0) {
			person[prop.substr(4)] = person[prop];
			delete person[prop];
		}
	});
}

function hasContent(variable) {
	if(variable == undefined || variable == " " || variable == null || variable == ""){
		return false;
	}
	return true;
}

</script>




